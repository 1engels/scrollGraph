var classGraph=function(){this.ctx,this.tableId,this.canvasId,this.timeInterval=timeInterval,this.interval=null,this.boundaries={},this.points=[],this.PPwidth=20,this.canvasWidth,this.canvasHeight,this.maxPointsNumber=2,this.pointRadio=5,this.yAxisData={yMax:null,ticks:4,marks:[]},this.xAxisData=[],this.titleHeight=15,this.yAxisWidth=40,this.yAxisFontColor="#0000ff",this.xAxisHeight=15,this.xAxisFontColor="#000000",this.xAxisLabelWidth=50,this.xAxixFontSize=10,this.yDefaultDistance=2,this.$node};classGraph.prototype.Init=function(t,i,s,a,h,e,n,o,r,x,l){var t=t||"0px",i=i||"0px",s=s||"0px",a=a||"0px";this.canvasWidth=parseInt(s.substring(0,s.length-2)),this.canvasHeight=parseInt(a.substring(0,a.length-2));var h=h||"0px",e=e||"#000",n=n||"solid",o=o||"";this.$node=r||"";var x=x||"",p=Math.random().toString(36).substring(6);this.buildCanvas(p,t,i,s,a,h,e,n,l),this.ctx=document.getElementById(p).getContext("2d"),this.buildTitle(o),this.periodicTimer(x,o),this.yAxis(),this.xAxis()},classGraph.prototype.buildTitle=function(t,i){var i=i||"...";t=this.$node.prev().prev().text();var t=t+" : "+i.toString();this.ctx.clearRect(this.yAxisWidth,0,this.canvasWidth,this.titleHeight),this.ctx.fillStyle="#000000",this.ctx.font="normal 14px Arial",this.ctx.textBaseLine="middle",this.ctx.textAlign="center",this.ctx.fillText(t,this.canvasWidth/2,this.titleHeight)},classGraph.prototype.buildCanvas=function(t,i,s,a,h,e,n,o,r){var x='<canvas id="'+t+'" width="'+a.toString()+'" height="'+h.toString()+'" style="position:absolute;width:'+a+";height:"+h+";top:"+s+"; left:"+i+"; border-width:"+e+"; border-style: "+o+";border-bottom-width: "+e+"; border-color:"+n+";z-index:1000; background-color:#f0f0f0; border: "+r+';">Your browser does not support Canvas :(</canvas>';$("body").append(x)},classGraph.prototype.setBoundaries=function(){this.boundaries.x0=this.yAxisWidth,this.boundaries.xf=this.canvasWidth,this.boundaries.y0=this.titleHeight,this.boundaries.yf=this.canvasHeight-this.xAxisHeight,this.maxPointsNumber=parseInt((this.boundaries.xf-this.boundaries.x0)/this.PPwidth)+1},classGraph.prototype.yAxis=function(){this.ctx.fillStyle="#fafafa",this.ctx.fillRect(0,0,this.boundaries.x0,this.canvasHeight)},classGraph.prototype.xAxis=function(){this.ctx.fillStyle="#fafafa",this.ctx.fillRect(this.boundaries.x0,this.boundaries.yf,this.canvasWidth,this.canvasHeight-this.boundaries.yf)},classGraph.prototype.periodicTimer=function(t,i){var t=t||"",s=this;this.interval=setInterval(function(){s.setBoundaries(),s.$node=$("#"+t),s.updateData(i)},this.timeInterval)},classGraph.prototype.updateData=function(t){var i=this.getVal();this.ctx.clearRect(this.boundaries.x0,this.boundaries.y0,this.canvasWidth-this.yAxisWidth,this.canvasHeight-this.xAxisHeight-this.titleHeight),this.resizeYAxis(i),0==this.points.length?this.points.push([this.boundaries.x0,this.fixedVal(i),i]):this.points.length>0&&this.points.length<this.maxPointsNumber?this.points.push([this.boundaries.x0+this.PPwidth*this.points.length,this.fixedVal(i),i]):this.points.length==this.maxPointsNumber&&this.refreshPoints([this.boundaries.x0+this.PPwidth*(this.points.length-1),this.fixedVal(i),i]),this.plotPoints(t,i),this.xAxis(),this.xMarks(),this.yAxis(),this.yMarks()},classGraph.prototype.fixedValPre=function(t){return parseInt(t*(this.boundaries.yf-this.boundaries.y0)/this.yAxisData.yMax)},classGraph.prototype.fixedVal=function(t){return this.boundaries.yf-this.fixedValPre(t)},classGraph.prototype.plotPoints=function(t,i){this.buildTitle(t,i);for(var s=0;s<this.maxPointsNumber&&"undefined"!=typeof this.points[s];s++)this.ctx.fillStyle="#000000",0==s?this.ctx.fillRect(this.points[s][0],this.points[s][1]-parseInt(this.pointRadio/2),this.pointRadio,this.pointRadio):this.ctx.fillRect(this.points[s][0]-parseInt(this.pointRadio/2),this.points[s][1]-parseInt(this.pointRadio/2),this.pointRadio,this.pointRadio),s>0&&(this.ctx.beginPath(),this.ctx.moveTo(this.points[s-1][0],this.points[s-1][1]),this.ctx.lineTo(this.points[s][0],this.points[s][1]),this.ctx.closePath(),this.ctx.strokeStyle="#777777",this.ctx.lineWidth=1,this.ctx.stroke())},classGraph.prototype.reAllocatePoints=function(){for(var t=0;t<this.points.length;t++)this.points[t][1]=this.fixedVal(this.points[t][2])},classGraph.prototype.refreshPoints=function(t){for(var i=0;i<this.maxPointsNumber-1;i++)this.points[i][0]=0==i?this.boundaries.x0:this.points[i+1][0]-this.PPwidth,this.points[i][1]=this.points[i+1][1],this.points[i][2]=this.points[i+1][2];this.points[this.maxPointsNumber-1]=t},classGraph.prototype.resizeYAxis=function(t){null==this.yAxisData.yMax&&(this.yAxisData.yMax=parseInt(2*t));this.fixedValPre(t);this.points.length>=2&&(t>1.5*this.points[this.points.length-1][2]||t>.95*this.yAxisData.yMax?(this.yAxisData.yMax=parseInt(2*t),this.reAllocatePoints()):(t<.5*this.points[this.points.length-1][2]||t<.2*this.yAxisData.yMax)&&(this.yAxisData.yMax=parseInt(1.2*this.points[this.points.length-1][2]),this.reAllocatePoints()))},classGraph.prototype.yMarks=function(){this.yAxisData.marks=[];for(var t=this.yAxisData.ticks-1,i=0;t>i;i++)this.yAxisData.marks.push(0);for(var i=0;t>=i;i++)this.yAxisData.marks[i]=parseInt(this.yAxisData.yMax*i/t),this.yAxisData.marks[i]>=1e3&&this.yAxisData.marks[i]<1e6?this.yAxisData.marks[i]=parseInt(this.yAxisData.marks[i]/1e3).toString()+"k":this.yAxisData.marks[i]>=1e6&&this.yAxisData.marks[i]<1e9?this.yAxisData.marks[i]=parseInt(this.yAxisData.marks[i]/1e6).toString()+"M":this.yAxisData.marks[i]>=1e9&&(this.yAxisData.marks[i]=parseInt(this.yAxisData.marks[i]/1e9).toString()+"B");for(var i=this.yAxisData.marks.length-1;i>=0;i--)this.ctx.font="normal 10px Arial",this.ctx.textBaseLine="middle",this.ctx.textAlign="right",this.ctx.fillStyle=this.yAxisFontColor,this.ctx.fillText((isNaN(this.yAxisData.marks[i])?"":this.yAxisData.marks[i]).toString()+" _",this.yAxisWidth,(this.canvasHeight-this.titleHeight-this.xAxisHeight)/(this.yAxisData.ticks-1)*(t-i)+this.titleHeight)},classGraph.prototype.xMarks=function(){if(this.points.length<=2)return!1;var t=parseInt((this.points[this.points.length-1][0]-this.boundaries.x0-this.xAxisLabelWidth)/this.xAxisLabelWidth)+1;if(2>t)return!1;var i=new Date,s=this.timeInterval*(this.points.length-1)/(t-1);this.xAxisData=[];for(var a=t;a>=0;a--)this.xAxisData.push(0);for(var a=t;a>=0;a--)this.xAxisData[a]=this.getTimeLabel(i.getTime()-(t-a)*s);for(var a=0;t>=a;a++)this.ctx.font="normal "+this.xAxixFontSize+"px Arial",this.ctx.textBaseLine="middle",this.ctx.textAlign="right",this.ctx.fillStyle=this.xAxisFontColor,this.ctx.fillText(this.xAxisData[a],this.boundaries.x0+this.xAxisLabelWidth*a,this.canvasHeight-this.xAxisHeight+this.xAxixFontSize)},classGraph.prototype.getTimeLabel=function(t){var i=new Date(t);return i.getHours().toString()+":"+i.getMinutes().toString()+":"+i.getSeconds().toString()},classGraph.prototype.getVal=function(){var t=parseFloat(this.$node.text());return isNaN(t)?0:t},classGraph.prototype.toLocalTime=function(t){return t-60*(new Date).getTimezoneOffset()},classGraph.prototype.setPPwidth=function(t){this.PPwidth=t},classGraph.prototype.getYMarks=function(){console.log(this.yAxisData.marks)};var x=[];$(document).ready(function(){$("body").find("span[supplemental=NumericItem]").each(function(){var t=$(this).closest("table");if($(this).attr("xpath").indexOf("dt='6'")>0){var i=$(this).prev().prev().text();tableId=Math.random().toString(36).substring(6),$(this).attr("id",tableId);var s=new classGraph;s.Init(t.css("left"),t.css("top"),t.css("width"),t.css("height"),t.css("border-width"),t.css("border-color"),t.css("border-style"),i,$(this),tableId,t.css("border")),x.push(s)}})});
